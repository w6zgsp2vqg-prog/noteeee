<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>NEINEI — AI Shell</title>
<style>
:root{
  --bg:#050507;
  --neon:#00d4ff;
  --neon-2:#0077ff;
  --panel:#0b0b0d;
  --muted:#9aa3aa;
  --accent-glow: 0 6px 18px rgba(0,212,255,0.08);
}
*{box-sizing:border-box}
html,body{height:100%;margin:0;font-family:Inter,monospace;background:var(--bg);color:var(--neon);display:flex;flex-direction:column}
header{
  background:var(--panel);
  border-bottom:1px solid rgba(0,212,255,0.18);
  padding:12px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  font-weight:600;
  letter-spacing:1.5px;
  font-size:16px;
}
.chat-container{
  flex:1;
  padding:20px;
  overflow-y:auto;
  display:flex;
  flex-direction:column;
  gap:12px;
}
.message{
  max-width:72%;
  padding:10px 14px;
  border-radius:10px;
  line-height:1.4;
  word-break:break-word;
  white-space:pre-wrap;
  box-shadow: var(--accent-glow);
}
.ai{
  align-self:flex-start;
  background:rgba(0,212,255,0.04);
  border:1px solid rgba(0,212,255,0.14);
  color:var(--neon);
}
.user{
  align-self:flex-end;
  background:linear-gradient(90deg,var(--neon),var(--neon-2));
  color:#001;
  font-weight:700;
}
.input-area{
  display:flex;
  gap:10px;
  padding:12px;
  border-top:1px solid rgba(0,212,255,0.12);
  background:var(--panel);
  align-items:center;
}
.input-area input{
  flex:1;
  background:#0b0b0d;
  border:1px solid rgba(0,212,255,0.16);
  color:var(--neon);
  padding:10px 12px;
  border-radius:8px;
  outline:none;
  font-family:Inter,monospace;
}
.input-area button{
  padding:10px 16px;
  border-radius:8px;
  border:none;
  background:linear-gradient(90deg,var(--neon),var(--neon-2));
  color:#001;
  font-weight:700;
  cursor:pointer;
}
.input-area button:active{transform:translateY(1px)}
::-webkit-scrollbar{width:8px}
::-webkit-scrollbar-thumb{background:rgba(0,212,255,0.12);border-radius:6px}

/* Modal */
.modal-overlay{
  position:fixed;
  inset:0;
  display:none;
  justify-content:center;
  align-items:center;
  background:rgba(0,0,0,0.65);
  z-index:1200;
}
.modal {
  width:420px;
  max-width:92%;
  background:var(--panel);
  border:1px solid rgba(0,212,255,0.14);
  padding:18px;
  border-radius:12px;
  color:var(--neon);
  box-shadow:0 8px 30px rgba(0,212,255,0.06);
}
.modal h3{margin:0 0 10px 0;font-size:15px}
.modal .row{display:flex;gap:8px;align-items:center}
.modal input{
  flex:1;
  background:#060608;
  border:1px solid rgba(0,212,255,0.08);
  color:var(--neon);
  padding:10px;border-radius:8px;outline:none;font-family:Inter,monospace;
}
.modal .btn{
  padding:8px 12px;border-radius:8px;border:none;background:linear-gradient(90deg,var(--neon),var(--neon-2));color:#001;font-weight:700;cursor:pointer;
}
.modal .small {font-size:13px;color:var(--muted);margin-top:10px;white-space:pre-wrap}
.info-box{
  background:#071017;border:1px solid rgba(0,212,255,0.06);padding:12px;border-radius:8px;margin-top:12px;font-family:Inter,monospace;font-size:13px;white-space:pre-wrap;
}
@media (max-width:460px){
  .message{max-width:92%}
  .modal{width:92%}
}
</style>
</head>
<body>
<header>NEINEI — AI Shell</header>
<div class="chat-container" id="chat"></div>
<div class="input-area">
  <input id="commandInput" type="text" placeholder="명령어를 입력하세요... (예: help)" autocomplete="off" />
  <button id="sendBtn">Send</button>
</div>

<div class="modal-overlay" id="safeModal">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="safeTitle">
    <h3 id="safeTitle">SECRET KEY</h3>
    <div class="row">
      <input id="secretInput" placeholder="SECRET KEY를 입력하세요" />
      <button id="secretSubmit" class="btn">Enter</button>
    </div>
    <div class="small" id="safeMsg">입력 후 Enter 또는 버튼을 눌러주세요.</div>
    <div id="secretResult" style="margin-top:10px;"></div>
    <div style="margin-top:12px;display:flex;justify-content:flex-end;gap:8px">
      <button id="safeClose" class="btn" style="background:transparent;border:1px solid rgba(0,212,255,0.12);color:var(--neon)">Close</button>
    </div>
  </div>
</div>

<script>
const chat=document.getElementById('chat');
const input=document.getElementById('commandInput');
const sendBtn=document.getElementById('sendBtn');

function getNotes(){return JSON.parse(localStorage.getItem('notes'))||[];}
function saveNotes(notes){localStorage.setItem('notes',JSON.stringify(notes));}

const profileBlock=[
"ID CODE : NEI-Z1A.v2.07",
"",
"ROLE / TEAM : Hacker / TEAM RED",
"",
"STATUS : ONLINE",
"",
"EXPERTISE : Web Application Penetration Testing",
"",
"AGE / SEX : 2006.08.19 F",
"",
"LANGUAGE : KOREAN, ENGLISH, JAPANESE",
"",
"LAST UPDATE : 2025.10.16"
].join('\n');

const whoamiText="I am NEINEI — a lightweight local AI shell simulator. I emulate a command-driven assistant that can inspect and manage local notes and respond to a small set of commands.";
const sensitiveResp="민감한 정보는 출력할 수 없습니다. 올바른 명령어를 사용하세요.";

function addMessage(sender,text){
  const el=document.createElement('div');
  el.className='message '+(sender==='user'?'user':'ai');
  el.textContent=text;
  chat.appendChild(el);
  chat.scrollTop=chat.scrollHeight;
}
function resetChat(){
  chat.innerHTML='';
  addMessage('ai',"AI 쉘에 오신 것을 환영합니다. 'help'를 입력해보세요!");
}
function fetchLocalIP(timeout=1200){
  return new Promise(resolve=>{
    let found=null;
    try{
      const pc=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"}]});
      pc.createDataChannel('');
      pc.onicecandidate=(evt)=>{
        if(!evt||!evt.candidate)return;
        const c=evt.candidate.candidate;
        const m=c.match(/([0-9]{1,3}(?:\.[0-9]{1,3}){3})/);
        if(m){
          found=m[1];
          try{pc.close();}catch(e){}
          resolve(found);
        }
      };
      pc.createOffer().then(sdp=>pc.setLocalDescription(sdp)).catch(()=>{});
      setTimeout(()=>{try{pc.close();}catch(e){};resolve(found);},timeout);
    }catch(e){resolve(null);}
  });
}

async function handleCommand(raw){
  const cmd=(raw||'').trim();
  if(!cmd)return"올바른 명령이 아닙니다";
  const parts=cmd.split(' ');
  const base=parts[0].toLowerCase();

  // ✅ 수정된 부분: helpText 줄바꿈 포함
  const helpText = 
"사용 가능한 명령어 목록:\n"+
"help - 명령어 목록 보기\n"+
"ls - 저장된 노트 목록 보기\n"+
"ls num - 저장된 노트 개수 표시\n"+
"cat - 내용 출력\n"+
"profile - 사용자 정보 출력\n"+
"delete - 삭제\n"+
"ping - 현재 IP 주소 보기\n"+
"reset - 대화 초기화\n"+
"exit - 노트 페이지로 돌아가기";

  if(base==='help')return helpText;

  if(base==='ls'){
    const notes=getNotes();
    if(parts[1]&&parts[1].toLowerCase()==='num')return`저장된 글의 개수: ${notes.length}`;
    if(notes.length===0)return"저장된 글이 없습니다.";
    return"저장된 글 목록:\n"+notes.map(n=>`- ${n.title}`).join('\n');
  }

  if(base==='cat'){
    const m=cmd.match(/'(.*?)'/);
    if(!m)return"cat 명령어 사용법: cat '[제목]'";
    const title=m[1];
    const notes=getNotes();
    const note=notes.find(n=>n.title===title);
    if(!note)return"해당 제목의 글을 찾을 수 없습니다.";
    return`Title: ${note.title}\n\n${note.content}`;
  }

  if(base==='profile')return profileBlock;
  if(base==='delete'){
    const m=cmd.match(/'(.*?)'/);
    if(!m)return"삭제할 제목을 작은따옴표('')로 감싸 입력해주세요.";
    const title=m[1];
    const notes=getNotes();
    const idx=notes.findIndex(n=>n.title===title);
    if(idx===-1)return"해당 제목의 글을 찾을 수 없습니다.";
    notes.splice(idx,1);
    saveNotes(notes);
    return`Completed: '${title}' 삭제 완료`;
  }

  if(base==='reset'){resetChat();return null;}
  if(base==='exit'){addMessage('ai','AI 쉘을 종료합니다. note 페이지로 이동합니다...');setTimeout(()=>{window.location.href='note.html';},1200);return null;}

  if(base==='ping'){
    addMessage('ai','ping 정보를 조회합니다...');
    const ip=await fetchLocalIP(1200);
    const ipText=ip?`IP ADDRESS : ${ip}`:"IP ADDRESS : Unavailable (브라우저 제한)";
    const macText="MAC ADDRESS : Unavailable (브라우저/보안 제한)";
    const t=new Date().toISOString();
    return`${ipText}\n${macText}\n\nTIME : ${t}`;
  }

  if(cmd.toLowerCase().trim()==='who are you')return whoamiText;
  if(base==='secret'||base==='flag')return sensitiveResp;
  if(base==='safe'){showSafeModal();return null;}

  return"올바른 명령이 아닙니다";
}

sendBtn.addEventListener('click',async()=>{
  const txt=input.value.trim();
  if(!txt)return;
  addMessage('user',txt);
  input.value='';
  try{
    const res=await handleCommand(txt);
    if(res!==null&&res!==undefined)addMessage('ai',res);
  }catch(e){addMessage('ai','명령 실행 중 오류가 발생했습니다.');}
});
input.addEventListener('keydown',e=>{if(e.key==='Enter')sendBtn.click();});
resetChat();

const safeModal=document.getElementById('safeModal');
const secretInput=document.getElementById('secretInput');
const secretSubmit=document.getElementById('secretSubmit');
const safeClose=document.getElementById('safeClose');
const safeMsg=document.getElementById('safeMsg');
const secretResult=document.getElementById('secretResult');

function showSafeModal(){
  secretInput.value='';
  secretResult.innerHTML='';
  safeMsg.textContent="SECRET KEY: 입력 후 Enter 또는 Enter 버튼을 눌러주세요.";
  safeModal.style.display='flex';
  setTimeout(()=>secretInput.focus(),120);
}
function closeSafeModal(){safeModal.style.display='none';}
safeClose.addEventListener('click',()=>{closeSafeModal();addMessage('ai','SAFE 창을 닫았습니다.');});
secretSubmit.addEventListener('click',handleSecretSubmit);
secretInput.addEventListener('keydown',e=>{if(e.key==='Enter')handleSecretSubmit();});

function handleSecretSubmit(){
  const v=(secretInput.value||'').trim();
  secretResult.innerHTML='';
  if(v===''){safeMsg.textContent='키를 입력하세요.';return;}
  if(v==='qlalfqjsghdjfuqwy/'){
    safeMsg.textContent='Loading ...';
    setTimeout(()=>{
      safeMsg.textContent='[ Loading ... - User Information ]';
      const info=[
        "Name: Kim Chana",
        "Birthday : August 19, 2006",
        "Sex : Female",
        "Address : 194-12 Seodong-ro, Iksan-si, Republic of Korea",
        "Phone Number : 010-4914-6364",
        "E-Mail : lovetipany123@gmail.com"
      ].join('\n');
      const box=document.createElement('div');
      box.className='info-box';
      box.textContent=info;
      secretResult.appendChild(box);
      // ✅ 수정: safe 창에서만 표시되고 채팅창엔 출력하지 않음
    },900);
  }else{
    secretResult.innerHTML='<div class="info-box">잘못된 키입니다.</div>';
    safeMsg.textContent="retry?"; 
  }
}
</script>
</body>
</html>
